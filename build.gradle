apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'application'

repositories {
    mavenCentral()
	mavenRepo url: "http://maven.restlet.org"
}

jar {
	version = '0.1'
    manifest.attributes("Main-Class": "org.jvalue.ods.main.DataServerMain")
}

mainClassName = "org.jvalue.ods.main.DataServerMain"

dependencies {
    compile 'com.fasterxml.jackson.core:jackson-databind:2.2.3'
    compile 'com.fasterxml.jackson.core:jackson-core:2.2.3'
    compile 'com.fasterxml.jackson.core:jackson-annotations:2.2.3'
	compile 'org.restlet.jse:org.restlet:2.1.6'
	compile 'org.restlet.jse:org.restlet.ext.jackson:2.1.6'
	compile 'org.ektorp:org.ektorp:1.4.1'
	compile 'org.slf4j:slf4j-api:1.7.5'
	compile 'org.slf4j:slf4j-log4j12:1.7.5'	
	testCompile 'junit:junit:4.11'
}

test {
    systemProperties 'property': 'value'
}

idea.project.ipr {
    withXml { provider ->
        provider.node.component.find { it.@name == 'VcsDirectoryMappings' }.mapping.@vcs = 'Git'
    }
}

task grabData(type: JavaExec, dependsOn: 'classes') {
    main = 'org.jvalue.ods.main.DataGrabberMain'
	classpath = sourceSets.main.runtimeClasspath
}

// integration test

sourceSets {
  integrationTest {
    compileClasspath = sourceSets.main.output + configurations.testRuntime
    runtimeClasspath = output + sourceSets.main.output + configurations.testRuntime
    java {
      srcDir 'src/integrationtest/integration'
    }
  }
 }
  

//task integrationTest(type: Test) {
//  testClassesDir = sourceSets.integrationTest.output.classesDir
//  classpath = sourceSets.integrationTest.runtimeClasspath
//}

//build.dependsOn integrationTest